!function(){angular.module("ajoslin.promise-tracker",[]).provider("promiseTracker",function(){this.$get=["$q","$timeout",function(n,e){function r(n){n&&e.cancel(n)}return function t(i){if(!(this instanceof t))return new t(i);i=i||{};var o,c,u=[],a=this,f=i.minDuration,s=i.activationDelay;a.active=function(){return c?!1:u.length>0},a.tracking=function(){return u.length>0},a.destroy=a.cancel=function(){o=r(o),c=r(c);for(var n=u.length-1;n>=0;n--)u[n].resolve();u.length=0},a.createPromise=function(){function t(){f&&(o=e(angular.noop,f))}function i(){return function(){(o||n.when()).then(function(){var n=u.indexOf(a);u.splice(n,1),0===u.length&&(c=r(c))})}}var a=n.defer();return u.push(a),1===u.length&&(s?c=e(function(){c=r(c),t()},s):t()),a.promise.then(i(!1),i(!0)),a},a.addPromise=function(e){if(e=e&&(e.$promise||e)||{},!e.then)throw new Error("promiseTracker#addPromise expects a promise object!");var r=a.createPromise();return e.then(function(n){return r.resolve(n),n},function(e){return r.reject(e),n.reject(e)}),r}}}]})}();